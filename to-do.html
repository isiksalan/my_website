<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>to-do with dates</title>
    <link rel="icon" href="images/logo.gif" type="image/gif">
    <link rel="stylesheet" href="styles_to-do-page.css">
</head>
<body>
    <!-- Fixed header with button -->
    <div class="header-container">
        <h1>my own to-do list</h1>
        <div class="header-button-container">
            <button class="btn btn-layered-3d btn-layered-3d--pink header-btn" onclick="window.location.href='index.html'">
                Home
            </button>
        </div>
        <div class="date-selector">
        <div class="date-selector-inner">
            <button class="date-nav-button" id="prev-date">‚óÄ Prev</button>
            <div class="date-display">
                <div class="date-number" id="date-display">05/17/25</div>
                <div class="date-day" id="day-display">Saturday</div>
            </div>
            <button class="date-nav-button" id="next-date">Next ‚ñ∂</button>
            <button class="calendar-button" id="open-calendar">
                <img src="gifs/calendar-icon.gif" alt="Calendar" class="calendar-icon"> Calendar
            </button>
        </div>
        </div>
    </div>
    <audio id="celebration-music" src="music/clapping.wav" preload="auto"></audio>
    <!-- NEW: Date selector -->
    

    <!-- Date picker container (hidden by default) -->
    <div class="date-picker-container" id="date-picker">
        <button class="close-calendar" id="close-calendar">√ó</button>
        <div class="date-picker-header">
            <div class="month-selector">
                <button class="month-nav" id="prev-month">‚óÄ</button>
                <div class="month-title" id="month-year-display">May 2025</div>
                <button class="month-nav" id="next-month">‚ñ∂</button>
            </div>
        </div>
        <div class="calendar-grid">
            <div class="day-header">Su</div>
            <div class="day-header">Mo</div>
            <div class="day-header">Tu</div>
            <div class="day-header">We</div>
            <div class="day-header">Th</div>
            <div class="day-header">Fr</div>
            <div class="day-header">Sa</div>
            <!-- Calendar days will be added here via JavaScript -->
        </div>
    </div>

    <!-- New container for the side-by-side layout -->
    <div class="tasks-container">
        <!-- Update your corner-gif div to include the tooltip -->
        <div class="corner-gif" id="corner-gif-container">
            <img src="gifs/britney-sits.gif" alt="Corner decoration">
            <div class="achievement-tooltip" id="achievement-counter">
                <div>You have achieved</div>
                <div id="goal-count">0 goals</div>
                <div>today!</div>
            </div>
        </div>
        <div id="retro-stats-window" class="retro-window" style="display: none;">
                <div class="retro-window-titlebar">
                    <div class="retro-window-title">‚ú® Achievement Stats ‚ú®</div>
                    <button class="retro-window-close" id="close-stats-window">√ó</button>
                </div>
                <div class="retro-window-content">
                    <div class="retro-stats-grade-container">
                        <div class="retro-stats-grade-label">Weekly Grade:</div>
                        <div class="retro-stats-grade" id="weekly-grade">A+</div>
                    </div>
                    <div class="retro-graph-container">
                        <div class="retro-graph-title">Last 7 Days Achievements</div>
                        <div class="retro-graph" id="achievements-graph">
                            <!-- Graph bars will be generated here -->
                        </div>
                        <div class="retro-graph-legend">
                            <div class="days-legend" id="days-legend">
                                <!-- Day labels will be generated here -->
                            </div>
                        </div>
                    </div>
                    <div class="retro-stats-total">
                        <div class="retro-stats-total-label">Total achievements this week:</div>
                        <div class="retro-stats-total-value" id="total-achievements">21</div>
                    </div>
                </div>
        </div>
            
        <!-- Overlay for the retro window -->
        <div id="retro-window-overlay" class="retro-window-overlay" style="display: none;"></div>
        <!-- To-do list container -->
        <div class="notebook-container">
            <div class="todo-header">
                <div class="title-with-gifs">
                    <img src="gifs/colorful-stars.gif" alt="‚ú®" class="tiny-gif">
                    <h1>My To-Do List</h1>
                    <img src="gifs/colorful-stars.gif" alt="‚ú®" class="tiny-gif">
                </div>
            </div>
            <!-- Welcome message for empty days -->
            <div class="welcome-message" id="empty-day-message" style="display: none;">
                No tasks yet.. How could that be?!
            </div>
            
            <div class="todo-input-container">
                <input type="text" id="todo-input" placeholder="Add a new task...">
                <button id="add-button">Add</button>
            </div>
            <ul class="todo-list" id="todo-list">
                <!-- To-do items will be added here -->
            </ul>
        </div>
        
        <!-- Achieved tasks container, now positioned to the right -->
        <div class="achieved-container">
            <div class="achieved-header">
                <div class="title-with-gifs">
                    <img src="gifs/cute-bubble-star.gif" alt="‚ú®" class="tiny-gif">
                    <h2>Achieved Tasks</h2>
                    <img src="gifs/cute-bubble-star.gif" alt="‚ú®" class="tiny-gif">
                </div>

                <div id="hover-time-display" class="hover-time-display">
                    <span class="time-label">Completed at: </span>
                    <span id="time-value">--:--</span>
                </div>
            </div>
            <ul class="achieved-list" id="achieved-list">
                <!-- Achieved items will be added here -->
            </ul>
        </div>
        <div id="party-celebration" style="display: none;">
            <!-- Darkened overlay -->
            <div class="party-overlay"></div>
            
            <!-- Rainbow spotlight container -->
            <div class="spotlight-container">
                <div class="rainbow-spotlight"></div>
                <div class="spotlight-dust"></div>
                <!-- Dancing man in spotlight -->
                <img src="gifs/dancing-man.gif" alt="Party time!" class="dancing-man">
            </div>
            
            <!-- Disco balls container -->
            <div class="disco-container">
                <!-- Disco balls will be added dynamically -->
            </div>
            
            <!-- Close button -->
            <button id="close-party" class="close-party">√ó STOP PARTY</button>
        </div>

        <!-- Add the audio element for the celebration song -->
        <audio id="celebration-song" src="music/sean-temperature.mp3" preload="auto"></audio>

    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        // Set the background image for the body
        const setBackgroundImage = () => {
            document.body.style.backgroundImage = 'url("backgrounds/back-290.gif")';
            document.body.style.backgroundRepeat = 'repeat';
            document.body.style.backgroundSize = 'auto';
        };
        
        setBackgroundImage();
        
        // DOM elements
        const todoInput = document.getElementById('todo-input');
        const addButton = document.getElementById('add-button');
        const todoList = document.getElementById('todo-list');
        const achievedList = document.getElementById('achieved-list');
        const dateDisplayEl = document.getElementById('date-display');
        const dayDisplayEl = document.getElementById('day-display');
        const prevDateBtn = document.getElementById('prev-date');
        const nextDateBtn = document.getElementById('next-date');
        const openCalendarBtn = document.getElementById('open-calendar');
        const datePickerEl = document.getElementById('date-picker');
        const closeCalendarBtn = document.getElementById('close-calendar');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const monthYearDisplayEl = document.getElementById('month-year-display');
        const calendarGridEl = document.querySelector('.calendar-grid');
        const emptyDayMessageEl = document.getElementById('empty-day-message');
        const cornerGif = document.querySelector('.corner-gif');
        const closeStatsBtn = document.getElementById('close-stats-window');
        const overlay = document.getElementById('retro-window-overlay');
        
        // Date management
        let currentDate = new Date(); // Default to today
        let currentCalendarMonth = new Date(); // For the calendar view
        
        // Format date as MM/DD/YY string
        const formatDateDisplay = (date) => {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = String(date.getFullYear()).slice(-2);
            return `${month}/${day}/${year}`;
        };
        
        // Get day name
        const getDayName = (date) => {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[date.getDay()];
        };
        
        // Format date as YYYY-MM-DD for storage key
        const formatDateForStorage = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };
        
        // Function to get achievement data for the last 7 days
        function getLast7DaysData() {
            const data = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                const dateKey = formatDateForStorage(date);
                const dateData = JSON.parse(localStorage.getItem(`todoData_${dateKey}`) || 'null');
                
                const achievementCount = dateData && dateData.achieved ? dateData.achieved.length : 0;
                
                data.push({
                    date: date,
                    count: achievementCount
                });
            }
            
            return data;
        }

        // Calculate total achievements across all days
        function calculateTotalAchievements(daysData) {
            return daysData.reduce((total, day) => total + day.count, 0);
        }

        // Determine grade based on total achievements
        function determineGrade(total) {
            if (total >= 21) return { letter: 'A+', class: 'grade-ap' };
            if (total >= 17) return { letter: 'A', class: 'grade-a' };
            if (total >= 14) return { letter: 'B+', class: 'grade-bp' };
            if (total >= 8) return { letter: 'B', class: 'grade-b' };
            if (total >= 7) return { letter: 'C+', class: 'grade-cp' };
            if (total >= 4) return { letter: 'C-', class: 'grade-c' };
            if (total >= 3) return { letter: 'D+', class: 'grade-dp' };
            if (total >= 2) return { letter: 'D-', class: 'grade-d' };
            if (total >= 1) return { letter: 'F+', class: 'grade-fp' };
            return { letter: 'F-', class: 'grade-f' };
        }

        // Update the grade display
        function updateGradeDisplay(grade, totalAchievements) {
            const gradeElement = document.getElementById('weekly-grade');
            gradeElement.textContent = grade.letter;
            
            // Remove any existing grade classes
            gradeElement.className = 'retro-stats-grade';
            
            // Add the appropriate grade class
            gradeElement.classList.add(grade.class);
            
            // Update total achievements
            document.getElementById('total-achievements').textContent = totalAchievements;
        }

        // Generate the graph for the last 7 days
        function generateGraph(daysData) {
            const graphContainer = document.getElementById('achievements-graph');
            const daysLegend = document.getElementById('days-legend');
            
            // Clear existing content
            graphContainer.innerHTML = '';
            daysLegend.innerHTML = '';
            
            // Find the maximum achievement count to scale the graph
            const maxCount = Math.max(...daysData.map(day => day.count));
            const graphHeight = 180; // Same as the CSS height
            const scale = maxCount > 0 ? graphHeight / maxCount : 0;
            
            // Add Y-axis labels
            const yAxisLabels = document.createElement('div');
            yAxisLabels.className = 'y-axis-labels';
            
            // If we have data, create labels
            if (maxCount > 0) {
                // Create 6 evenly spaced labels
                const labelCount = 6;
                for (let i = 0; i < labelCount; i++) {
                    const value = Math.round((maxCount / (labelCount - 1)) * (labelCount - 1 - i));
                    const label = document.createElement('div');
                    label.className = 'y-label';
                    label.textContent = value;
                    yAxisLabels.appendChild(label);
                }
            } else {
                // If no data, just show one label
                const label = document.createElement('div');
                label.className = 'y-label';
                label.textContent = '0';
                yAxisLabels.appendChild(label);
            }
            
            graphContainer.appendChild(yAxisLabels);
            
            // Add bars for each day
            daysData.forEach((day, index) => {
                // Create bar
                const bar = document.createElement('div');
                bar.className = 'graph-bar';
                
                // Calculate bar height based on count
                const height = day.count * scale;
                bar.style.height = `${height}px`;
                
                // Add value label
                const valueLabel = document.createElement('div');
                valueLabel.className = 'graph-bar-value';
                valueLabel.textContent = day.count;
                bar.appendChild(valueLabel);
                
                // Add bar to container
                graphContainer.appendChild(bar);
                
                // Add day label
                const dayLabel = document.createElement('div');
                dayLabel.className = 'day-label';
                
                // Get short day name (Sun, Mon, etc.)
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayLabel.textContent = dayNames[day.date.getDay()];
                
                daysLegend.appendChild(dayLabel);
            });
        }

        // Update date display
        const updateDateDisplay = () => {
            dateDisplayEl.textContent = formatDateDisplay(currentDate);
            dayDisplayEl.textContent = getDayName(currentDate);
            
            // Also update the calendar if it's open
            if (datePickerEl.style.display === 'block') {
                updateCalendarView();
            }
        };
        
        // Navigate to the previous day
        const goToPrevDay = () => {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() - 1);
            currentDate = newDate;
            updateDateDisplay();
            loadDataForCurrentDate();
        };
        
        // Navigate to the next day
        const goToNextDay = () => {
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + 1);
            currentDate = newDate;
            updateDateDisplay();
            loadDataForCurrentDate();
        };
        
        // Navigate to specific date
        const goToDate = (date) => {
            currentDate = new Date(date);
            updateDateDisplay();
            loadDataForCurrentDate();
        };
        
        // Function to update achievement count for the current date
        const updateAchievementCount = () => {
            const goalCount = document.getElementById('goal-count');
            if (goalCount) {
                const count = document.getElementById('achieved-list').children.length;
                goalCount.textContent = `${count} goal${count !== 1 ? 's' : ''}`;
            }
        };
        
        // Check if a date has any tasks
        const dateHasTasks = (date) => {
            const dateKey = formatDateForStorage(date);
            const dateData = JSON.parse(localStorage.getItem(`todoData_${dateKey}`) || 'null');
            if (!dateData) return false;
            
            return (dateData.todos && dateData.todos.length > 0) || 
                (dateData.achieved && dateData.achieved.length > 0);
        };
        
        // Load data for the current date
        const loadDataForCurrentDate = () => {
            // Clear existing lists
            todoList.innerHTML = '';
            achievedList.innerHTML = '';
            
            const dateKey = formatDateForStorage(currentDate);
            const dateData = JSON.parse(localStorage.getItem(`todoData_${dateKey}`) || 'null');
            
            if (dateData) {
                // Load todos
                if (dateData.todos && dateData.todos.length > 0) {
                    dateData.todos.forEach(todo => {
                        addTodoToDOM(todo.text);
                    });
                    emptyDayMessageEl.style.display = 'none';
                }
                
                // Load achieved
                if (dateData.achieved && dateData.achieved.length > 0) {
                    dateData.achieved.forEach(item => {
                        addToAchievedList(item.text, item.completionTime);
                    });
                    emptyDayMessageEl.style.display = 'none';
                }
                
                // Show empty message if no tasks
                if ((!dateData.todos || dateData.todos.length === 0) && 
                    (!dateData.achieved || dateData.achieved.length === 0)) {
                    emptyDayMessageEl.style.display = 'block';
                }
            } else {
                // No data for this date
                emptyDayMessageEl.style.display = 'block';
            }
            
            // Update achievement count
            updateAchievementCount();
        };
        
        // Save data for the current date
        const saveDataForCurrentDate = () => {
            const dateKey = formatDateForStorage(currentDate);
            
            const todos = Array.from(todoList.children).map(item => {
                return {
                    text: item.querySelector('.todo-text').textContent
                };
            });
            
            const achieved = Array.from(achievedList.children).map(item => {
                return {
                    text: item.querySelector('.todo-text').textContent,
                    completionTime: item.dataset.completionTime || null
                };
            });
            const dateData = { todos, achieved };
            localStorage.setItem(`todoData_${dateKey}`, JSON.stringify(dateData));
            
            // Handle empty day message visibility
            if (todos.length === 0 && achieved.length === 0) {
                emptyDayMessageEl.style.display = 'block';
            } else {
                emptyDayMessageEl.style.display = 'none';
            }
            
            // Update the calendar if it's open
            if (datePickerEl.style.display === 'block') {
                updateCalendarView();
            }
        };
        
        // Generate and update the calendar view
        const updateCalendarView = () => {
            // Clear out days from the previous render, but keep the header row
            const dayElements = calendarGridEl.querySelectorAll('.calendar-day');
            dayElements.forEach(el => el.remove());
            
            // Get first day of the month and last day of the month
            const firstDay = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth(), 1);
            const lastDay = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth() + 1, 0);
            
            // Update month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                'July', 'August', 'September', 'October', 'November', 'December'];
            monthYearDisplayEl.textContent = `${monthNames[currentCalendarMonth.getMonth()]} ${currentCalendarMonth.getFullYear()}`;
            
            // Get the day of week the first day falls on (0 = Sunday, 6 = Saturday)
            const firstDayOfWeek = firstDay.getDay();
            
            // Get some days from the previous month to fill the calendar grid
            const daysFromPrevMonth = firstDayOfWeek;
            const prevMonthLastDay = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth(), 0).getDate();
            
            // Generate previous month days
            for (let i = daysFromPrevMonth - 1; i >= 0; i--) {
                const dayNum = prevMonthLastDay - i;
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = dayNum;
                
                // Create date object for this day
                const dayDate = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth() - 1, dayNum);
                
                // Check if this date has tasks
                if (dateHasTasks(dayDate)) {
                    dayElement.classList.add('has-tasks');
                }
                
                dayElement.addEventListener('click', () => {
                    goToDate(dayDate);
                    datePickerEl.style.display = 'none';
                });
                
                calendarGridEl.appendChild(dayElement);
            }
            
            // Generate current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day current-month';
                dayElement.textContent = i;
                
                // Create date object for this day
                const dayDate = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth(), i);
                
                // Check if this is the selected date
                if (dayDate.getDate() === currentDate.getDate() && 
                    dayDate.getMonth() === currentDate.getMonth() && 
                    dayDate.getFullYear() === currentDate.getFullYear()) {
                    dayElement.classList.add('selected');
                }
                
                // Check if this date has tasks
                if (dateHasTasks(dayDate)) {
                    dayElement.classList.add('has-tasks');
                }
                
                dayElement.addEventListener('click', () => {
                    goToDate(dayDate);
                    datePickerEl.style.display = 'none';
                });
                
                calendarGridEl.appendChild(dayElement);
            }
            
            // Calculate how many days we need from the next month to complete the grid
            const totalDaysDisplayed = daysFromPrevMonth + lastDay.getDate();
            const daysFromNextMonth = Math.ceil(totalDaysDisplayed / 7) * 7 - totalDaysDisplayed;
            
            // Generate next month days
            for (let i = 1; i <= daysFromNextMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = i;
                
                // Create date object for this day
                const dayDate = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth() + 1, i);
                
                // Check if this date has tasks
                if (dateHasTasks(dayDate)) {
                    dayElement.classList.add('has-tasks');
                }
                
                dayElement.addEventListener('click', () => {
                    goToDate(dayDate);
                    datePickerEl.style.display = 'none';
                });
                
                calendarGridEl.appendChild(dayElement);
            }
        };
        
        // Add a new to-do item to the DOM
        const addTodoToDOM = (text) => {
            const todoItem = document.createElement('li');
            todoItem.className = 'todo-item';
            
            const todoText = document.createElement('span');
            todoText.className = 'todo-text';
            todoText.textContent = text;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'button-container';

             // Create Edit button
            const editButton = document.createElement('button');
            editButton.className = 'edit-button';
            editButton.innerHTML = '<span class="edit-icon">‚úèÔ∏è</span>';
    
            
            const doneButton = document.createElement('button');
            doneButton.className = 'done-button';
            doneButton.innerHTML = '<span class="edit-icon">‚úÖ</span>';
            
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-button';
            deleteButton.innerHTML = '<span class="edit-icon">‚ùå</span>';
            
            buttonContainer.appendChild(editButton);
            buttonContainer.appendChild(doneButton);
            buttonContainer.appendChild(deleteButton);
            
            todoItem.appendChild(todoText);
            todoItem.appendChild(buttonContainer);
            todoList.appendChild(todoItem);
            
            // Hide empty message
            emptyDayMessageEl.style.display = 'none';
            const music = document.getElementById('celebration-music');
            if (music) {
                music.currentTime = 0; // Reset to beginning
                music.volume = 0.6; // Set volume to 60%
            }

            // Edit functionality
            editButton.addEventListener('click', () => {
                // Create input field with current text
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'edit-input';
                input.value = todoText.textContent;
                
                // Replace text with input
                todoItem.replaceChild(input, todoText);
                
                // Focus the input
                input.focus();
                
                // Create save button
                const saveButton = document.createElement('button');
                saveButton.className = 'save-button';
                saveButton.textContent = 'Save';
                
                // Replace edit button with save button
                buttonContainer.replaceChild(saveButton, editButton);
                
                // Save functionality
                saveButton.addEventListener('click', () => {
                    const newText = input.value.trim();
                    if (newText) {
                        // Update text and restore original buttons
                        todoText.textContent = newText;
                        todoItem.replaceChild(todoText, input);
                        buttonContainer.replaceChild(editButton, saveButton);
                        saveDataForCurrentDate();
                    }
                });
                        // Handle Enter key in input
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const newText = input.value.trim();
                        if (newText) {
                            // Update text and restore original buttons
                            todoText.textContent = newText;
                            todoItem.replaceChild(todoText, input);
                            buttonContainer.replaceChild(editButton, saveButton);
                            saveDataForCurrentDate();
                        }
                    }
                });

                        // Cancel edit if input loses focus
                input.addEventListener('blur', () => {
                    // Small delay to allow save button click to work
                    setTimeout(() => {
                        if (todoItem.contains(input)) {
                            todoItem.replaceChild(todoText, input);
                            if (buttonContainer.contains(saveButton)) {
                                buttonContainer.replaceChild(editButton, saveButton);
                            }
                        }
                    }, 100);
                });
            });
    


            
            // Add event listeners
            doneButton.addEventListener('click', () => {
                if (music) {
                    const playPromise = music.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("Audio playback failed:", error);
                        });
                    }
                }
                
                // Move to achieved list
                todoList.removeChild(todoItem);
                const completionTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});  
                addToAchievedList(text, completionTime);
                saveDataForCurrentDate();
            });
            
            deleteButton.addEventListener('click', () => {
                todoList.removeChild(todoItem);
                saveDataForCurrentDate();
            });
        };
        
        // Add an item to the achieved list
        const addToAchievedList = (text, completionTime = null) => {
            const achievedItem = document.createElement('li');
            achievedItem.className = 'achieved-item';
            
            // Store the completion time as a data attribute
            if (completionTime) {
                achievedItem.dataset.completionTime = completionTime;
            }
            console.log('Adding achieved item with completion time:', completionTime);

            const achievedText = document.createElement('span');
            achievedText.className = 'todo-text';
            achievedText.textContent = text;
            
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-button';
            deleteButton.innerHTML = '<span class="delete-icon">üóëÔ∏è</span>';
            
            achievedItem.appendChild(achievedText);
            achievedItem.appendChild(deleteButton);
            achievedList.appendChild(achievedItem);
            
            // Hide empty message
            emptyDayMessageEl.style.display = 'none';
            
            // Add hover event listeners for time display
            const timeDisplay = document.getElementById('hover-time-display');
            const timeValue = document.getElementById('time-value');
            
            achievedItem.addEventListener('mouseenter', function() {
                if (this.dataset.completionTime) {
                    console.log('Mouse entered achieved item');
                    console.log('Completion time data:', this.dataset.completionTime);
                    
                    // Get the time display elements
                    const timeDisplay = document.getElementById('hover-time-display');
                    const timeValue = document.getElementById('time-value');
                    
                    // Set the time value
                    timeValue.textContent = this.dataset.completionTime;
                    
                    // Make it visible with a class instead of inline styles
                    timeDisplay.classList.add('active');
                }
            });
            
                        
            achievedItem.addEventListener('mouseleave', function() {
                const timeDisplay = document.getElementById('hover-time-display');
                timeDisplay.classList.remove('active');
            });
            
            // Add event listener for delete
            deleteButton.addEventListener('click', () => {
                achievedList.removeChild(achievedItem);
                saveDataForCurrentDate();
                updateAchievementCount();
            });
            
            // Update achievement count
            updateAchievementCount();
        };
        // Function to add random celebration GIFs to the party
        function addRandomCelebrationGifs() {
            // Array of celebration GIFs - add your file paths here
            const celebrationGifs = [
                'gifs/party-gif1.gif',  // Replace with your actual GIF paths
                'gifs/party-gif2.gif',
                'gifs/party-gif3.gif',
                'gifs/party-gif4.gif',
                'gifs/party-gif5.gif'
                // Add more GIFs as needed
            ];
            
            // Get the party container
            const partyContainer = document.getElementById('party-celebration');
            if (!partyContainer) return;
            
            // Create a container for the celebration GIFs if it doesn't exist
            let gifContainer = document.querySelector('.celebration-gifs-container');
            if (!gifContainer) {
                gifContainer = document.createElement('div');
                gifContainer.className = 'celebration-gifs-container';
                partyContainer.appendChild(gifContainer);
            }
            
            // Clear any existing GIFs
            gifContainer.innerHTML = '';
            
            // Number of GIFs to add
            const numGifsToAdd = 25; // You can change this number
            
            // Add random GIFs
            for (let i = 0; i < numGifsToAdd; i++) {
                // Select a random GIF from the array
                const randomIndex = Math.floor(Math.random() * celebrationGifs.length);
                const gifSrc = celebrationGifs[randomIndex];
                
                // Create a container for this specific GIF with animation
                const gifElement = document.createElement('div');
                gifElement.className = 'celebration-gif';
                
                // Create the image element
                const img = document.createElement('img');
                img.src = gifSrc;
                img.alt = 'Celebration';
                
                // Add image to container
                gifElement.appendChild(img);
                
                // Random position on screen
                const topPosition = Math.floor(Math.random() * 70) + 10; // 10-80% from top
                const leftPosition = Math.floor(Math.random() * 70) + 10; // 10-80% from left
                
                // Random size (50-150px)
                const size = Math.floor(Math.random() * 100) + 50;
                
                // Apply styles
                gifElement.style.position = 'absolute';
                gifElement.style.top = `${topPosition}%`;
                gifElement.style.left = `${leftPosition}%`;
                gifElement.style.width = `${size}px`;
                gifElement.style.height = `${size}px`;
                gifElement.style.zIndex = '1005'; // Above other elements
                
                // Add random animation
                const animations = [
                    'bounce 2s infinite',
                    'spin 3s infinite linear',
                    'pulse 2s infinite',
                    'wobble 3s infinite'
                ];
                const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
                gifElement.style.animation = randomAnimation;
                
                // Add to container
                gifContainer.appendChild(gifElement);
            }
        }
        // Function to add dust particles to the spotlight beam
        function addSpotlightDustEffect() {
            // Create dust container if it doesn't exist
            let dustContainer = document.querySelector('.spotlight-dust');
            if (!dustContainer) {
                dustContainer = document.createElement('div');
                dustContainer.className = 'spotlight-dust';
                document.querySelector('.spotlight-container').appendChild(dustContainer);
            }
            
            // Clear existing particles
            dustContainer.innerHTML = '';
            
            // Add new dust particles
            const numParticles = 30;
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'dust-particle';
                
                // Random position within the spotlight beam
                const leftPos = 40 + Math.random() * 20; // 40-60% from left
                const topPos = Math.random() * 60; // 0-60% from top
                
                // Random size
                const size = 1 + Math.random() * 3;
                
                // Random animation duration and delay
                const duration = 3 + Math.random() * 6;
                const delay = Math.random() * 5;
                
                // Apply styles
                particle.style.left = `${leftPos}%`;
                particle.style.top = `${topPos}%`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                particle.style.animation = `floatDust ${duration}s linear ${delay}s infinite`;
                
                // Add to container
                dustContainer.appendChild(particle);
            }

        }
        // Function to start the party celebration
        function startPartyCelebration() {
            console.log("Starting party celebration!"); // Debug log
            
            // Get the audio element
            const celebrationSong = document.getElementById('celebration-song');
            if (!celebrationSong) {
                console.error("Could not find celebration-song element!");
                return;
            }
            
            // Show the celebration container
            const partyCelebration = document.getElementById('party-celebration');
            if (!partyCelebration) {
                console.error("Could not find party-celebration element!");
                return;
            }
            
            partyCelebration.style.display = 'block';
            // Inside your startPartyCelebration function
            // After the line: partyCelebration.style.display = 'block';
            addSpotlightDustEffect();
            addRandomCelebrationGifs();
            // Add the party mode class to the grade
            const gradeElement = document.getElementById('weekly-grade');
            if (gradeElement) {
                gradeElement.classList.add('party-mode');
            } else {
                console.error("Could not find weekly-grade element!");
            }
            
            // Add disco balls randomly around the page
            const discoContainer = document.querySelector('.disco-container');
            if (!discoContainer) {
                console.error("Could not find disco-container element!");
                return;
            }
            
            discoContainer.innerHTML = ''; // Clear any existing disco balls
            
            // Create 15 disco balls
            for (let i = 0; i < 15; i++) {
                const discoBall = document.createElement('img');
                discoBall.src = 'gifs/disco-ball.gif'; // Make sure you have this GIF
                discoBall.className = 'disco-ball';
                
                // Random position
                const randomTop = Math.floor(Math.random() * 80) + 10; // 10-90%
                const randomLeft = Math.floor(Math.random() * 80) + 10; // 10-90%
                
                discoBall.style.top = `${randomTop}%`;
                discoBall.style.left = `${randomLeft}%`;
                
                // Random size
                const randomSize = Math.floor(Math.random() * 50) + 50; // 50-100px
                discoBall.style.width = `${randomSize}px`;
                discoBall.style.height = `${randomSize}px`;
                
                // Add to container
                discoContainer.appendChild(discoBall);
            }
            
            // Play the celebration song with error handling
            celebrationSong.volume = 0.7; // 70% volume
            celebrationSong.currentTime = 0; // Start from beginning
            
            try {
                const playPromise = celebrationSong.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error("Audio playback failed:", error);
                    });
                }
            } catch (e) {
                console.error("Error playing audio:", e);
            }
            
            // Set up event listener for close button
            const closePartyButton = document.getElementById('close-party');
            if (closePartyButton) {
                // Remove existing listeners to prevent duplicates
                const newCloseButton = closePartyButton.cloneNode(true);
                closePartyButton.parentNode.replaceChild(newCloseButton, closePartyButton);
                newCloseButton.addEventListener('click', stopPartyCelebration);
            } else {
                console.error("Could not find close-party button!");
            }
        }
        
        // Function to stop the party
        function stopPartyCelebration() {
            console.log("Stopping party celebration!"); // Debug log
            
            // Get elements
            const partyCelebration = document.getElementById('party-celebration');
            const celebrationSong = document.getElementById('celebration-song');
            const gradeElement = document.getElementById('weekly-grade');
            
            // Hide the celebration container
            if (partyCelebration) {
                partyCelebration.style.display = 'none';
            }
            
            // Stop the music
            if (celebrationSong) {
                celebrationSong.pause();
            }
            
            // Remove party mode class
            if (gradeElement) {
                gradeElement.classList.remove('party-mode');
            }
        }
        
        // Function to show retro stats window with added party celebration check
        function showRetroStatsWindow() {
            console.log("Showing stats window"); // Debug log
            
            // Get the last 7 days of data
            const last7DaysData = getLast7DaysData();
            
            // Calculate total and determine grade
            const totalAchievements = calculateTotalAchievements(last7DaysData);
            const grade = determineGrade(totalAchievements);
            
            // Update the grade display
            updateGradeDisplay(grade, totalAchievements);
            
            // Generate the graph
            generateGraph(last7DaysData);
            
            // Show the window and overlay
            document.getElementById('retro-stats-window').style.display = 'block';
            document.getElementById('retro-window-overlay').style.display = 'block';
            
            // Check if grade is A+ after a short delay to ensure the DOM is updated
            setTimeout(() => {
                const gradeElement = document.getElementById('weekly-grade');
                console.log("Grade element text:", gradeElement ? gradeElement.textContent : 'not found');
                
                if (gradeElement && gradeElement.textContent === 'A+') {
                    console.log("A+ grade detected! Starting party...");
                    startPartyCelebration();
                }
            }, 500);
        }
        
        // Function to close retro stats window with added party cleanup
        function closeRetroStatsWindow() {
            console.log("Closing stats window"); // Debug log
            
            // Stop the party if it's active
            stopPartyCelebration();
            
            // Hide the window and overlay
            document.getElementById('retro-stats-window').style.display = 'none';
            document.getElementById('retro-window-overlay').style.display = 'none';
        }
        
        // ===== Event Listeners =====
        
        // Add new to-do when Add button is clicked
        addButton.addEventListener('click', () => {
            const text = todoInput.value.trim();
            if (text) {
                addTodoToDOM(text);
                todoInput.value = '';
                saveDataForCurrentDate();
            }
        });
        
        // Add new to-do when Enter key is pressed
        todoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const text = todoInput.value.trim();
                if (text) {
                    addTodoToDOM(text);
                    todoInput.value = '';
                    saveDataForCurrentDate();
                }
            }
        });
        
        // Previous day navigation
        prevDateBtn.addEventListener('click', goToPrevDay);
        
        // Next day navigation
        nextDateBtn.addEventListener('click', goToNextDay);
        
        // Open calendar
        openCalendarBtn.addEventListener('click', () => {
            // Set calendar to current view month/year
            currentCalendarMonth = new Date(currentDate);
            updateCalendarView();
            datePickerEl.style.display = 'block';
        });
        
        // Close calendar
        closeCalendarBtn.addEventListener('click', () => {
            datePickerEl.style.display = 'none';
        });
        
        // Previous month in calendar
        prevMonthBtn.addEventListener('click', () => {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() - 1);
            updateCalendarView();
        });
        
        // Next month in calendar
        nextMonthBtn.addEventListener('click', () => {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + 1);
            updateCalendarView();
        });
        
        // Stats window events
        cornerGif.addEventListener('click', showRetroStatsWindow);
        closeStatsBtn.addEventListener('click', closeRetroStatsWindow);
        overlay.addEventListener('click', closeRetroStatsWindow);
        
        // Initialize the app
        updateDateDisplay();
        loadDataForCurrentDate();
        
        // Hide date picker initially
        datePickerEl.style.display = 'none';
        
        // FOR TESTING ONLY - Uncomment to test the party celebration
        // setTimeout(() => { startPartyCelebration(); }, 3000);
        
        // Check for required elements and log to console
        console.log("Checking for required elements...");
        ["celebration-song", "party-celebration", "weekly-grade", "close-party", "disco-container"].forEach(id => {
            console.log(`Element '${id}': ${document.getElementById(id) ? 'Found ‚úì' : 'MISSING ‚ùå'}`);
        });
    });
    </script>
    
    
</body>
</html>